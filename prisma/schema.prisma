// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Post {
  // 1. id (Primary Key, Auto-Increment)
  // GENERATED ALWAYS AS IDENTITYëŠ” Prismaì—ì„œ @default(autoincrement())ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
  id              Int       @id @default(autoincrement())
  
  // 2. ì œëª© (í•„ìˆ˜, NOT NULL)
  title           String    @db.VarChar(255)
  
  // 3. ë³¸ë¬¸ (TEXT) - ê¸¸ì´ ì œí•œ ì—†ìŒ.
  // TEXTëŠ” Prismaì—ì„œ Stringìœ¼ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
  content         String
  
  // 4. ì‘ì„± ì‹œê° (TIMESTAMP WITH TIME ZONE, ê¸°ë³¸ê°’ now())
  // DBì— DEFAULT NOW() ì„¤ì •ì´ ë˜ì–´ ìˆë‹¤ë©´, Prismaì—ì„œëŠ” @default(now())ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
  created_at      DateTime  @default(now()) @map("created_at")
  
  // 5. ìˆ˜ì • ì‹œê° (TIMESTAMP WITH TIME ZONE, ì—…ë°ì´íŠ¸ ì‹œ ìë™ ê°±ì‹ )
  updated_at      DateTime  @updatedAt @map("updated_at")
  
  // 6. ê³µê°œ ì—¬ë¶€ (BOOLEAN DEFAULT 'false')
  // PrismaëŠ” 'false' ëŒ€ì‹  ë¶ˆë¦¬ì–¸ ê°’ì¸ falseë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  is_published    Boolean   @default(false) @map("is_published")
  
  // 7. ìš”ì•½ (VARCHAR(500))
  // DB êµ¬ì¡°ì— summaryê°€ NULL í—ˆìš©ì´ë¼ë©´ String? (ì„ íƒ ì‚¬í•­)ìœ¼ë¡œ ì •ì˜í•˜ì„¸ìš”.
  // ì—¬ê¸°ì„œëŠ” VARCHAR(500)ì— ë§ê²Œ Stringìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤.
  summary         String?   @db.VarChar(500) 
  
  // 8. ì¸ë„¤ì¼ URL (í•„ìˆ˜, NOT NULL, ê¸°ë³¸ê°’ ì„¤ì •)
  // DBì—ì„œ "URL"ì„ ìŒë”°ì˜´í‘œê°€ ì•„ë‹Œ í™‘ë”°ì˜´í‘œë¡œ ê°ì‹¸ì„œ DEFAULT ê°’ì„ ì„¤ì •í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
  // Prismaì—ì„œëŠ” ê¸°ë³¸ê°’ ì„¤ì • ì‹œ ì‘ì€ë”°ì˜´í‘œë¡œ ê°ì‹¼ ë¬¸ìì—´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
  thumbnail_url   String    @db.VarChar(255) @default("https://hyamwcz838h4ikyf.public.blob.vercel-storage.com/default_thumbnail.png") @map("thumbnail_url")
  
  // 9. ì‹¤ì œ DB í…Œì´ë¸” ì´ë¦„ ì§€ì • (í…Œì´ë¸” ì´ë¦„ì´ 'posts'ë¼ê³  ê°€ì •)
  @@map("posts") 
}

model User {
  // ê¸°ë³¸ NextAuth ìš”êµ¬ì‚¬í•­
  id            String @id @default(uuid())
  email         String @unique
  emailVerified DateTime?
  
  // ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ì„ ìœ„í•œ í•„ë“œ
  hashedPassword String? // bcryptë¡œ í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

  // ğŸš¨ 2FA(TOTP)ë¥¼ ìœ„í•œ í•„ë“œ (ë¯¸ë¦¬ ì¶”ê°€í•´ ë‘¡ë‹ˆë‹¤)
  twoFactorSecret String? // TOTP ë¹„ë°€ í‚¤ ì €ì¥
  isTwoFactorEnabled Boolean @default(false)

  // NextAuth ì„¸ì…˜ ë° ê³„ì • ê´€ë¦¬ë¥¼ ìœ„í•œ í•„ë“œ (ì„ íƒ ì‚¬í•­ì´ì§€ë§Œ ì•ˆì „ì„ ìœ„í•´ ì¶”ê°€)
  name          String?
  image         String?
  accounts      Account[]
  sessions      Session[]

  // ğŸš¨ 2FA ì‹œë„ ì¤‘ ì„ì‹œ í† í° ì €ì¥ í•„ë“œ
  temp2FaToken  String?     // ì„ì‹œ í† í° (UUID ë“±)
  tempTokenExpiresAt DateTime? // í† í° ë§Œë£Œ ì‹œê°„

  @@map("User")
}

// NextAuth.js ì–´ëŒ‘í„°ê°€ ìš”êµ¬í•˜ëŠ” ëª¨ë¸ë“¤ (ID/PW ì¸ì¦ì—ëŠ” í•„ìˆ˜ ì•„ë‹˜, OAuth ì‹œ í•„ìš”)
// í•˜ì§€ë§Œ ë‚˜ì¤‘ì— í™•ì¥ì„±ì„ ìœ„í•´ ì¶”ê°€í•´ ë‘ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])

  @@map("Account")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("Session")
}

// ë¯¸ë””ì–´ ê´€ë¦¬ ì´ê´„ í…Œì´ë¸”
model Media {
  id              Int      @id @default(autoincrement())
  
  // Blob ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ ì‹¤ì œ íŒŒì¼ URL (ê³ ìœ ê°’)
  blob_url        String   @unique
  
  // íŒŒì¼ì˜ ì›ë˜ ì´ë¦„ (UUIDë¡œ ì €ì¥í–ˆë”ë¼ë„, ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ì´ë¦„)
  original_name   String
  
  // íŒŒì¼ì˜ MIME íƒ€ì… (image/jpeg, video/mp4 ë“±)
  mime_type       String
  
  // íŒŒì¼ì„ ì—…ë¡œë“œí•œ ì‚¬ìš©ì ID (ì¸ì¦ êµ¬í˜„ ì‹œ í•„ìˆ˜)
  uploaded_by     String?  // í˜„ì¬ëŠ” ì„ì‹œë¡œ String?ìœ¼ë¡œ ë‘ê³ , ì¸ì¦ êµ¬í˜„ í›„ User ëª¨ë¸ê³¼ ì—°ê²°
  
  // íŒŒì¼ì˜ í˜„ì¬ ìƒíƒœ: 
  // - PENDING: ì—…ë¡œë“œë§Œ ë˜ê³  ì•„ì§ ê²Œì‹œê¸€ì— ì‚¬ìš©ë˜ì§€ ì•Šì€ ì„ì‹œ íŒŒì¼ (ì •ë¦¬ ëŒ€ìƒ)
  // - USED: í˜„ì¬ ê²Œì‹œê¸€ ë³¸ë¬¸ ë˜ëŠ” ì¸ë„¤ì¼ì— ì‚¬ìš© ì¤‘ì¸ íŒŒì¼
  // - SCHEDULED_FOR_DELETION: ê²Œì‹œê¸€ì—ì„œ ì‚­ì œ/ê²Œì‹œê¸€ ìì²´ê°€ ì‚­ì œë˜ì–´ ì •ë¦¬ ëŒ€ê¸° ì¤‘ì¸ íŒŒì¼
  status          MediaStatus @default(PENDING)
  
  // íŒŒì¼ ê³µê°œ ìƒíƒœ
  is_public       Boolean   @default(true) @map("is_public")

  // íŒŒì¼ ìƒì„± ì‹œì 
  created_at      DateTime @default(now())
  
  // ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚¬ìš©ëœ ì‹œì  ë˜ëŠ” ì—…ë°ì´íŠ¸ ì‹œì  (Clean-up ê¸°ì¤€)
  updated_at      DateTime @updatedAt
  
  // ì‚­ì œê°€ ì˜ˆì•½ëœ ì‹œì  (Cron Jobì´ ì´ ì‹œê°„ì„ ë³´ê³  ì‚­ì œ)
  scheduled_delete_at DateTime?
}

// ë¯¸ë””ì–´ ìƒíƒœ ENUM
enum MediaStatus {
  PENDING // ì—…ë¡œë“œ ì™„ë£Œ, ì•„ì§ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
  USED    // ê²Œì‹œê¸€ ë³¸ë¬¸/ì¸ë„¤ì¼ì—ì„œ ì‚¬ìš© ì¤‘
  SCHEDULED_FOR_DELETION // ê²Œì‹œê¸€ì—ì„œ ì‚­ì œë˜ì—ˆê±°ë‚˜ ê²Œì‹œê¸€ ìì²´ê°€ ì‚­ì œë¨ (ì²­ì†Œ ëŒ€ê¸°)
}
